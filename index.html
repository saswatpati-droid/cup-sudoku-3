<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>1 vs 1 Sudoku</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root {
  --bg: #eef4ff;
  --card: #ffffff;
  --accent: #4f7cff;
  --grid: #94a3b8;
  --bold: #475569;
  --cell: #f8fbff;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  display: flex;
  justify-content: center;
  padding: 12px;
}

.app {
  width: 100%;
  max-width: 380px;
  background: var(--card);
  border-radius: 16px;
  padding: 14px;
}

h1 {
  text-align: center;
  color: var(--accent);
  margin: 4px 0;
}

.subtitle {
  text-align: center;
  font-size: 13px;
  margin-bottom: 8px;
  opacity: 0.75;
}

select, button, input {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  margin-top: 8px;
  font-size: 14px;
}

button {
  background: var(--accent);
  color: white;
  font-weight: 600;
}

.hidden { display: none; }

.board {
  display: grid;
  grid-template-columns: repeat(9, 1fr);
  width: min(92vw, 320px);
  aspect-ratio: 1;
  margin: 10px auto;
  gap: 1px;
}

.cell {
  background: var(--cell);
  border: 1px solid var(--grid);
  border-radius: 6px;
  text-align: center;
  font-size: 18px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cell:disabled {
  background: #dde7ff;
}

.cell.bold-r { border-right: 3px solid var(--bold); }
.cell.bold-b { border-bottom: 3px solid var(--bold); }

.pad {
  display: grid;
  grid-template-columns: repeat(9, 1fr);
  gap: 6px;
}

.pad button {
  background: #dbe6ff;
  color: #1e3a8a;
  font-weight: 700;
}

.reactions {
  display: flex;
  justify-content: space-around;
  margin-top: 8px;
  font-size: 22px;
}

.footer {
  text-align: center;
  font-size: 12px;
  opacity: 0.6;
  margin-top: 6px;
}
</style>
</head>

<body>
<div class="app">

<h1>1 vs 1 Sudoku</h1>
<div class="subtitle">Share link ‚Ä¢ Play simultaneously</div>

<!-- SETUP -->
<div id="setup">
  <select id="player">
    <option value="A">Chia</option>
    <option value="B">Chiklu</option>
  </select>

  <select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium" selected>Medium</option>
    <option value="hard">Hard</option>
  </select>

  <button onclick="joinGame()">Join Game</button>
</div>

<!-- GAME -->
<div id="game" class="hidden">
  <div class="board" id="board"></div>
  <div class="pad" id="pad"></div>

  <div class="reactions">
    <span onclick="sendReaction('üî•')">üî•</span>
    <span onclick="sendReaction('üòÇ')">üòÇ</span>
    <span onclick="sendReaction('üò§')">üò§</span>
    <span onclick="sendReaction('‚ù§Ô∏è')">‚ù§Ô∏è</span>
    <span onclick="sendReaction('üòà')">üòà</span>
  </div>

  <div id="reactionFeed"></div>
</div>

<div class="footer">Made by chiklu with ‚ù§Ô∏è</div>

</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyDVWYWtBbnIi4p2vEIcNPSypU5EcmDhPwU",
  authDomain: "vs1-sudoku.firebaseapp.com",
  databaseURL: "https://vs1-sudoku-default-rtdb.firebaseio.com",
  projectId: "vs1-sudoku",
});

const db = firebase.database();

/* GAME ID */
const params = new URLSearchParams(location.search);
const gameId = params.get("game") || Math.random().toString(36).slice(2);
const ref = db.ref("games/" + gameId);

/* SOLVED GRID */
const SOLUTION =
"534678912672195348198342567859761423426853791713924856961537284287419635345286179";

/* PUZZLE GENERATOR */
function generatePuzzle(diff) {
  let blanks = diff === "easy" ? 32 : diff === "medium" ? 45 : 60;
  let arr = SOLUTION.split("");
  let removed = 0;
  while (removed < blanks) {
    let i = Math.floor(Math.random() * 81);
    if (arr[i] !== "0") {
      arr[i] = "0";
      removed++;
    }
  }
  return arr.join("");
}

/* FLOW */
let me = "";
let selected = null;

function joinGame() {
  me = player.value;
  const diff = difficulty.value;

  ref.once("value", snap => {
    if (!snap.exists()) {
      ref.set({
        puzzle: generatePuzzle(diff)
      });
    }
    startGame();
  });

  history.replaceState(null, "", "?game=" + gameId);
}

function startGame() {
  setup.classList.add("hidden");
  game.classList.remove("hidden");

  ref.child("puzzle").once("value", snap => {
    renderBoard(snap.val());
  });

  buildPad();
}

/* BOARD */
function renderBoard(puzzle) {
  board.innerHTML = "";
  puzzle.split("").forEach((v, i) => {
    const c = document.createElement("input");
    c.className = "cell";
    c.maxLength = 1;

    const r = Math.floor(i / 9);
    const col = i % 9;
    if (col === 2 || col === 5) c.classList.add("bold-r");
    if (r === 2 || r === 5) c.classList.add("bold-b");

    if (v !== "0") {
      c.value = v;
      c.disabled = true;
    } else {
      c.onclick = () => selected = c;
    }

    board.appendChild(c);
  });
}

/* NUMBER PAD */
function buildPad() {
  pad.innerHTML = "";
  for (let i = 1; i <= 9; i++) {
    let b = document.createElement("button");
    b.textContent = i;
    b.onclick = () => {
      if (selected && !selected.disabled) selected.value = i;
    };
    pad.appendChild(b);
  }
}

/* REACTIONS */
function sendReaction(e) {
  ref.child("reactions").push({ from: me, e });
}

ref.child("reactions").on("child_added", s => {
  const r = s.val();
  reactionFeed.textContent = `${r.from}: ${r.e}`;
});
</script>

</body>
</html>
