<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>1 vs 1 Sudoku</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{
  --bg:#eef4ff;
  --card:#ffffff;
  --accent:#4f7cff;
  --cell:#f8fbff;
  --fixed:#dbe6ff;
  --grid:#94a3b8;
  --bold:#475569;
  --num:#1e3a8a;
  --wrong:#ffd6d6;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
  padding:12px;
}

.app{
  width:100%;
  max-width:380px;
  background:var(--card);
  border-radius:18px;
  padding:14px;
}

h1{
  text-align:center;
  color:var(--accent);
  margin:6px 0;
}

.subtitle{
  text-align:center;
  font-size:13px;
  opacity:.75;
  margin-bottom:10px;
}

select,button,input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  font-size:14px;
  margin-top:8px;
}

button{
  background:var(--accent);
  color:#fff;
  font-weight:600;
}

.hidden{display:none}

.board{
  display:grid;
  grid-template-columns:repeat(9,1fr);
  width:min(92vw,320px);
  aspect-ratio:1;
  margin:10px auto;
  gap:1px;
}

.cell{
  background:var(--cell);
  border:1px solid var(--grid);
  border-radius:6px;
  font-size:20px;
  font-weight:600;
  color:var(--num);
  display:flex;
  align-items:center;
  justify-content:center;
}

.cell.fixed{background:var(--fixed)}
.cell.selected{outline:2px solid var(--accent)}
.cell.wrong{background:var(--wrong)}

.cell.bold-r{border-right:3px solid var(--bold)}
.cell.bold-b{border-bottom:3px solid var(--bold)}

.pad{
  display:grid;
  grid-template-columns:repeat(9,1fr);
  gap:6px;
  margin-top:8px;
}

.pad button{
  background:var(--fixed);
  color:var(--num);
  font-weight:700;
  font-size:16px;
}

.reactions{
  display:flex;
  justify-content:space-around;
  margin-top:10px;
  font-size:22px;
}

.result{
  text-align:center;
  margin-top:14px;
  font-weight:600;
}

.footer{
  text-align:center;
  font-size:12px;
  opacity:.6;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="app">

<h1>1 vs 1 Sudoku</h1>
<div class="subtitle">Share link ‚Ä¢ Play simultaneously</div>

<!-- SETUP -->
<div id="setup">
  <select id="player">
    <option value="A">Chia</option>
    <option value="B">Chiklu</option>
  </select>

  <select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium" selected>Medium</option>
    <option value="hard">Hard</option>
  </select>

  <button onclick="join()">Continue</button>

  <div id="shareBox" class="hidden">
    <input id="link" readonly>
    <button onclick="copy()">Copy Link</button>
    <button onclick="start()">Start Game</button>
  </div>

  <div class="footer">Made by chiklu with ‚ù§Ô∏è</div>
</div>

<!-- GAME -->
<div id="game" class="hidden">
  <div class="board" id="board"></div>
  <div class="pad" id="pad"></div>

  <div class="reactions">
    <span onclick="react('üî•')">üî•</span>
    <span onclick="react('üòÇ')">üòÇ</span>
    <span onclick="react('üò§')">üò§</span>
    <span onclick="react('‚ù§Ô∏è')">‚ù§Ô∏è</span>
    <span onclick="react('üòà')">üòà</span>
  </div>

  <div id="result" class="result hidden"></div>
</div>

</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyDVWYWtBbnIi4p2vEIcNPSypU5EcmDhPwU",
  authDomain:"vs1-sudoku.firebaseapp.com",
  databaseURL:"https://vs1-sudoku-default-rtdb.firebaseio.com",
  projectId:"vs1-sudoku"
});
const db=firebase.database();

/* GAME STATE */
const params=new URLSearchParams(location.search);
const gameId=params.get("game")||Math.random().toString(36).slice(2);
const ref=db.ref("games/"+gameId);

const SOLUTION="534678912672195348198342567859761423426853791713924856961537284287419635345286179";
let puzzle="", me="", selected=null;
let startTime=0, mistakes=0, finished=false;

/* PUZZLE */
function gen(diff){
  let blanks=diff==="easy"?32:diff==="medium"?45:60;
  let arr=SOLUTION.split("");
  while(blanks){
    let i=Math.floor(Math.random()*81);
    if(arr[i]!=="0"){arr[i]="0";blanks--}
  }
  return arr.join("");
}

/* FLOW */
function join(){
  me=player.value;
  ref.once("value",s=>{
    if(!s.exists()){
      puzzle=gen(difficulty.value);
      ref.set({puzzle,results:{}});
    }
  });
  link.value=location.origin+location.pathname+"?game="+gameId;
  shareBox.classList.remove("hidden");
  history.replaceState(null,"","?game="+gameId);
}

function copy(){
  link.select();
  document.execCommand("copy");
}

function start(){
  setup.classList.add("hidden");
  game.classList.remove("hidden");
  startTime=Date.now();
  ref.child("puzzle").once("value",s=>render(s.val()));
  buildPad();
}

/* BOARD */
function render(p){
  board.innerHTML="";
  p.split("").forEach((v,i)=>{
    let d=document.createElement("div");
    d.className="cell";
    let r=Math.floor(i/9),c=i%9;
    if(c===2||c===5)d.classList.add("bold-r");
    if(r===2||r===5)d.classList.add("bold-b");

    if(v!=="0"){
      d.textContent=v;
      d.classList.add("fixed");
    }else{
      d.onclick=()=>{
        document.querySelectorAll(".cell").forEach(x=>x.classList.remove("selected"));
        d.classList.add("selected");
        selected=d;
      };
    }
    board.appendChild(d);
  });
}

/* PAD */
function buildPad(){
  pad.innerHTML="";
  for(let i=1;i<=9;i++){
    let b=document.createElement("button");
    b.textContent=i;
    b.onclick=()=>place(i);
    pad.appendChild(b);
  }
}

function place(n){
  if(!selected||selected.classList.contains("fixed")||finished)return;
  const idx=[...board.children].indexOf(selected);
  if(SOLUTION[idx]===String(n)){
    selected.textContent=n;
    selected.classList.remove("wrong","selected");
    selected=null;
    checkWin();
  }else{
    selected.classList.add("wrong");
    mistakes++;
  }
}

/* WIN CHECK */
function checkWin(){
  const filled=[...board.children].every((c,i)=>
    c.textContent && c.textContent===SOLUTION[i]
  );
  if(filled){
    finished=true;
    const time=Math.floor((Date.now()-startTime)/1000);
    const score=Math.max(0,10000-time*2-mistakes*100);
    ref.child("results/"+me).set({time,score});
  }
}

/* RESULTS */
ref.child("results").on("value",s=>{
  const r=s.val();
  if(!r||!r.A||!r.B)return;
  const a=r.A,b=r.B;
  const winner=a.score>b.score?"Player A":"Player B";
  const diff=Math.abs(a.score-b.score);
  result.innerHTML=`
    ${winner} wins üèÜ<br>
    A: ${a.score} (${a.time}s)<br>
    B: ${b.score} (${b.time}s)<br>
    Margin: ${diff}
  `;
  result.classList.remove("hidden");
});

/* REACTIONS */
function react(e){
  ref.child("reactions").push({from:me,e});
}
</script>
</body>
</html>
